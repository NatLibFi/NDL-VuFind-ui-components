<?php
$widget = $target == 'widget';
?>

<div class="js-schedule-widget schedule-widget organisation-info<?= $showDetails ? ' with-details' : '' ?><?= $widget ? ' organisation-info-widget' : '' ?>" data-parent="<?= $parent; ?>" data-target="<?= $target; ?>" data-id="<?= $id; ?>">
  <?php if ($widget) : ?>
    <h2>Heading</h2>
    <?= $this->render('components/molecules/messaging/loader/loader.phtml', ['loaderClass' => 'loader js-loader']); ?>
    <div class="js-content hide">
      <div class="<?= $showDetails ? 'info-col ' : ''; ?>info">
        <div class="organisation-wrapper">
          <div class="organisation-dropdown-holder">
            <?= $this->render('components/molecules/navigation/dropdowns/sort.phtml', ['items' => [], 'label' => 'Select library', 'dropdownClass' => 'organisation js-organisation-menu']) ?>
          </div>
          <div class="js-is-open">
            <span class="js-open is-open open js-info-element">
              <?= $open; ?>
            </span>
            <span class="js-closed is-open closed js-info-element">
              <?= $closed; ?>
            </span>
          </div>
        </div>
      <?php endif; ?>
      <div class="schedules info">
        <?= $this->render('components/molecules/navigation/pagination/pager-with-label.phtml', ['wrapperClass' => 'js-week-navigation week-navigation week-navi-holder', 'prevButton' => ['class' => 'week-navigation-control js-prev-week', 'text' => $previousWeek], 'label' => $week . ' <span class="js-week-number"></span>', 'nextButton' => ['class' => 'week-navigation-control js-next-week', 'text' => $nextWeek]]) ?>

        <?= $this->render('components/molecules/messaging/loader/loader.phtml', ['loaderClass' => 'loader js-loader']); ?>
        <div class="js-content">
          <div class="js-opening-times-week opening-times-week"></div>
        </div>
        <div class="js-no-schedules js-info-element">
          <?= $noSchedulesAvailable; ?>
        </div>
        <div class="js-mobile-schedules mobile-schedules info-element js-info-element"></div>
      </div>
      <div class="js-schedules-info schedules-info js-info-element">
      </div>
      <?php if ($widget && $showDetails) : ?>
      </div>
      <div class="details-col">
        <a href="" data-href="<?= $facilityImageLink; ?>">
          <img src="<?= $organisationPlaceholderImage; ?>" alt="" class="js-facility-image facility-image" />
        </a>
        <div class="details-wrapper">
          <div>
            <?= $this->render('components/molecules/tooltips/tooltip/tooltip.phtml', ['buttonClasses' => ['btn js-info-element js-email'], 'position' => 'bottom', 'buttonText' => "<i class='fa fa-at' aria-hidden='true'></i><span class='sr-only'>Email</span>", 'content' => ""]) ?>

            <?= $this->render('components/molecules/tooltips/tooltip/tooltip.phtml', ['buttonClasses' => ['btn js-info-element js-phone'], 'position' => 'bottom', 'buttonText' => "<i class='fa fa-phone-square' aria-hidden='true'></i><span class='sr-only'>Phone</span>", 'content' => ""]) ?>

            <a href="https://opas.matka.fi/?to=Linnankatu%202,%20Turku" target="_blank" class="js-route js-info-element btn">
              <i class="fa fa-bus" aria-hidden="true"></i>
              <span class="sr-only"><?= $directions; ?></span>
            </a>
          </div>
          <a href="<?= $facilityImageLink; ?>" target="_blank" class="js-facebook js-info-element btn">
            <i class="fa fa-facebook-square" aria-hidden="true"></i>
            <span class="sr-only"><?= $facebook ?></span>
          </a>
          <div class="js-map map js-info-element">
            <a href="https://www.google.com/maps?q=Linnankatu+2+Turku" target="_blank">
              <i class="fa fa-map-marker" aria-hidden="true">
              </i>
              <span class="js-map-address"></span>
            </a>
          </div>
          <div class="js-details-link js-info-element">
            <a href="" data-href="<?= $facilityImageLink; ?>">
              <i class="fa fa-home" aria-hidden="true"></i>
              <?= $servicePointInfo; ?>
            </a>
          </div>
          <div class="js-services services">
            <button class="btn btn-round js-service-wifi js-info-element">
              <i class="fa fa-wifi" aria-hidden="true"></i>
              <span class="sr-only"><?= $wifi; ?></span>
            </button>
            <button class="btn btn-round js-service-print js-info-element">
              <i class="fa fa-print" aria-hidden="true"></i>
              <span class="sr-only"><?= $print; ?></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  <?php endif; ?>
</div>

<template class="js-time-row-template">
  <div class="time-row">
    <div class="cell date">
      <span class="js-date"></span>
    </div>
    <div class="cell description">
      <span class="js-name"></span>
      <span class="js-staff name-staff">
        <?= $staffAvailable; ?>
      </span>
      <span class="info js-info"></span>
      <span class="js-selfservice selfservice-only hide">
        <?= $selfService; ?>
      </span>
    </div>
    <div class="cell time-container js-time-container"></div>
  </div>
</template>

<template class="js-time-template">
  <div class="time-template">
    <span class="js-period">
      <span class="js-opens"></span> - <span class="js-closes"></span>
    </span>
    <span class="js-closed closed-today hide">
      <?= $closed; ?>
    </span>
  </div>
</template>

<script type="text/javascript">
  $(document).ready(function onReady() {
    var service = finna.organisationInfo;

    finna.weekSchedule.init($('.js-schedule-widget'), service);

    finna.weekSchedule.loadOrganisationList();

    setTimeout(function() {
      finna.weekSchedule.showDetails('<?= $id; ?>', true);
    }, 1000)
  })
</script>
